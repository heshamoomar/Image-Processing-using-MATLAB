function [BW,maskedImage] = cat2_segmentImage(RGB)
%segmentImage Segment image using auto-generated code from Image Segmenter app
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the Image Segmenter app. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 04-May-2023
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Graph cut
foregroundInd = [4854 4855 4856 4857 4858 4859 4860 4982 4989 4990 4991 4992 5111 5121 5122 5123 5239 5252 5368 5382 5383 5494 5495 5496 5497 5498 5512 5513 5622 5623 5642 5643 5644 5751 5773 5879 5880 5903 6008 6032 6033 6136 6137 6162 6163 6264 6265 6292 6293 6392 6393 6422 6423 6520 6521 6552 6648 6649 6682 6776 6777 6811 6812 6900 6901 6902 6903 6904 6905 6906 6941 6942 7023 7024 7025 7026 7027 7028 7033 7034 7035 7036 7037 7071 7151 7152 7200 7201 7280 7281 7330 7406 7407 7408 7459 7460 7533 7534 7535 7589 7660 7661 7662 7718 7719 7787 7788 7789 7848 7913 7914 7915 7977 7978 8003 8040 8041 8042 8107 8132 8133 8134 8168 8169 8236 8263 8264 8295 8296 8297 8366 8390 8393 8394 8395 8407 8408 8409 8410 8411 8412 8413 8414 8415 8416 8417 8418 8422 8423 8497 8525 8526 8536 8542 8543 8544 8548 8549 8550 8648 8655 8656 8657 8665 8674 8675 8676 8759 8760 8777 8786 8787 8792 8889 8890 8906 8916 8917 8918 8920 8921 9019 9036 9149 9165 9278 9294 9295 9407 9424 9536 9553 9665 9682 9794 9812 9923 9941 9942 10052 10071 10182 10200 10311 10329 10440 10459 10569 10588 10698 10828 11086 11215 11344 11345 11474 11604 11621 11733 11750 11862 11992 12009 12121 12122 12138 12251 12267 12380 12396 12509 12510 12525 12639 12654 12769 12782 12783 12898 12911 13028 13040 13157 13168 13169 13286 13297 13415 13426 13544 13545 13555 13684 13803 13813 13932 13942 14061 14071 14199 14328 14448 14457 14577 14586 14706 14715 14844 14964 14973 15093 15102 15222 15231 15350 15360 15479 15489 15608 15618 15737 15747 15866 15876 15994 16004 16005 16123 16133 16252 16262 16380 16391 16509 16520 16637 16648 16765 16766 16893 16894 16906 17019 17020 17035 17164 17274 17275 17293 17399 17400 17401 17402 17403 17422 17521 17522 17523 17524 17525 17526 17527 17550 17649 17650 17679 17777 17807 17904 17905 17906 17936 18033 18065 18161 18162 18194 18201 18202 18203 18204 18205 18245 18246 18247 18248 18290 18323 18328 18329 18334 18335 18373 18419 18451 18456 18464 18465 18468 18469 18470 18471 18501 18548 18580 18583 18584 18594 18595 18596 18597 18600 18601 18602 18603 18630 18677 18709 18711 18733 18734 18757 18758 18767 18806 18837 18839 18840 18863 18864 18885 18935 18966 18967 18994 19012 19013 19064 19065 19094 19095 19123 19124 19140 19141 19155 19194 19223 19253 19254 19268 19269 19323 19383 19396 19397 19452 19512 19513 19524 19525 19543 19544 19581 19643 19644 19645 19646 19647 19648 19649 19650 19651 19652 19710 19804 19839 19933 19934 19969 20066 20068 20069 20098 20227 20329 20330 20356 20461 20485 20590 20614 20720 20721 20850 20872 21001 21110 21130 21239 21259 21517 21646 21756 21757 21886 21887 22016 22033 22162 22274 22275 22291 22420 22548 22662 22677 22792 22806 22921 22935 23050 23064 23179 23193 23437 23451 23567 23580 23696 23709 23825 23838 23954 23967 24083 24095 24096 24224 24341 24353 24470 24482 24599 24611 24728 24740 24858 24868 24869 24988 24997 25118 25119 25125 25126 25248 25249 25250 25251 25252 25253 25254 ];
backgroundInd = [69 71 74 76 77 190 313 317 337 355 359 364 370 439 477 478 479 480 481 482 506 556 641 642 724 725 726 772 849 854 900 911 912 915 917 918 926 930 931 967 972 1125 1131 1133 1134 1136 1137 1155 1169 1218 1269 1276 1280 1346 1364 1401 1402 1490 1501 1511 1536 1556 1655 1720 1722 1836 1846 1869 1888 2027 2072 2085 2119 2187 2213 2242 2245 2318 2401 2492 2544 2673 2729 2743 2744 2782 2783 2834 2846 2871 3035 3069 3189 3198 3199 3202 3233 3318 3350 3447 3465 3578 3620 3632 3669 3726 3820 3823 3825 3945 3946 3968 4124 4148 4176 4219 4247 4253 4265 4325 4430 4488 4535 4580 4608 4609 4637 4748 4794 4810 4811 4868 4869 4910 4924 5008 5028 5139 5184 5191 5219 5319 5398 5443 5601 5657 5671 5729 5787 5800 5991 6048 6060 6073 6074 6112 6177 6241 6308 6367 6376 6493 6567 6631 6632 6633 6721 6747 6851 6872 6956 6963 6981 6982 6994 6999 7113 7116 7119 7219 7350 7603 7732 7737 7862 7863 7864 8254 8641 8770 9029 9158 9417 9804 10449 10836 18312 18313 18314 18315 18316 18437 18438 18439 18440 18445 18564 18565 18566 18573 18691 18692 18693 18702 18816 18817 18818 18819 18831 18943 18944 18945 18960 19072 19084 19089 19201 19217 19330 19346 19459 19488 19489 19490 19491 19492 19493 19494 19495 19588 19603 19604 19616 19617 19626 19717 19740 19744 19745 19756 19758 19759 19760 19846 19853 19854 19855 19861 19869 19873 19889 19890 19891 19892 19975 19985 19986 19989 19998 20002 20021 20022 20023 20024 20025 20046 20047 20048 20049 20051 20052 20104 20116 20118 20130 20131 20173 20174 20175 20181 20182 20183 20184 20234 20242 20246 20247 20256 20259 20271 20273 20286 20301 20302 20313 20314 20363 20371 20374 20376 20385 20388 20402 20403 20417 20428 20429 20444 20492 20503 20504 20505 20514 20517 20527 20533 20535 20546 20547 20548 20549 20550 20551 20552 20553 20554 20555 20556 20557 20573 20574 20621 20627 20633 20634 20643 20646 20665 20704 20762 20764 20775 20784 20796 20834 20835 20879 20891 20894 20903 20927 20964 20965 20966 21009 21020 21023 21024 21025 21032 21041 21058 21095 21096 21138 21148 21149 21153 21154 21159 21161 21170 21188 21189 21190 21191 21211 21212 21213 21214 21225 21226 21267 21272 21277 21278 21282 21290 21325 21327 21329 21330 21331 21340 21345 21355 21356 21357 21396 21406 21411 21417 21419 21427 21461 21463 21478 21480 21525 21535 21536 21540 21546 21548 21610 21655 21664 21665 21669 21675 21677 21697 21698 21748 21784 21788 21794 21797 21798 21806 21813 21877 21913 21922 21924 21926 21933 21935 21954 21958 21960 22000 22007 22042 22051 22053 22055 22064 22071 22089 22091 22136 22171 22175 22180 22182 22184 22191 22193 22223 22224 22261 22262 22265 22266 22300 22304 22309 22313 22322 22356 22370 22371 22372 22373 22374 22378 22391 22395 22396 22429 22438 22440 22441 22449 22451 22487 22490 22494 22525 22558 22580 22640 22650 22654 22688 22691 22696 22707 22709 22783 22817 22823 22827 22836 22838 22909 22912 22946 22956 22967 22973 22985 23041 23078 23083 23094 23096 23159 23170 23210 23212 23213 23223 23225 23257 23259 23297 23299 23333 23336 23353 23354 23396 23397 23419 23428 23462 23470 23532 23548 23557 23599 23611 23684 23686 23720 23723 23727 23731 23741 23795 23815 23849 23860 23869 23870 23876 23899 23937 23944 23945 23984 23986 23999 24028 24030 24058 24072 24074 24107 24115 24145 24164 24169 24171 24173 24203 24257 24305 24306 24307 24309 24318 24325 24331 24332 24365 24368 24385 24392 24461 24497 24502 24515 24590 24591 24623 24643 24644 24707 24713 24720 24772 24779 24790 24849 24881 24902 24965 24978 24979 25010 25013 25018 25022 25030 25031 25037 25094 25108 25109 25139 25142 25147 25151 25159 25160 25230 25238 25268 25271 25280 25288 25289 25368 25409 25417 25418 25419 25435 25481 25496 25497 25498 25526 25529 25534 25546 25548 25609 25625 25627 25659 25675 25677 25693 25694 25695 25702 25709 25715 25720 25726 25730 25733 25756 25757 25784 25788 25792 25797 25804 25806 25811 25877 25883 25886 25907 25910 25911 25918 25921 25926 25933 25935 25940 26006 26012 26016 26034 26035 26040 26042 26047 26056 26062 26064 26145 26146 26148 26149 26150 26151 26152 26153 26154 26155 26156 26157 26158 26163 26191 26194 26264 26271 26275 26276 26287 26288 26291 26299 26300 26306 26307 26320 26323 26328 26400 26417 26418 26419 26420 26429 26430 26443 26449 26522 26529 26548 26549 26550 26551 26552 26553 26558 26559 26564 26565 26573 26581 26637 26638 26641 26649 26669 26670 26678 26684 26685 26687 26689 26690 26693 26695 26707 26710 26762 26799 26800 26801 26803 26807 26815 26817 26819 26824 26825 26831 26839 26847 26848 26882 26886 26887 26923 26934 26936 26944 26946 26949 26955 26956 26968 26980 26981 26987 26992 26998 27004 27050 27065 27066 27073 27075 27076 27077 27078 27086 27087 27098 27196 27197 27198 27199 27200 27201 27208 27209 27216 27217 27219 27223 27227 27317 27318 27319 27320 27323 27325 27331 27332 27338 27339 27340 27341 27342 27344 27345 27346 27348 27352 27356 27437 27438 27439 27440 27441 27442 27443 27444 27445 27477 27485 27506 27507 27508 27509 27510 27511 27512 27513 27514 27516 27517 27518 27519 27520 27521 27522 27523 27524 27525 27526 27527 27528 27529 27530 27564 27565 27566 27606 27610 27614 27615 27616 27617 27618 27619 27620 27621 27622 27623 27624 27625 27626 27627 27628 27629 27631 27632 27633 27634 27635 27664 27665 27666 27668 27669 27670 27674 27679 27683 27686 27687 27735 27739 27745 27746 27747 27767 27768 27847 27848 27849 27850 27851 27852 27853 27854 27855 27856 27857 27858 27859 27860 27861 27862 27863 27864 27868 27872 27873 27874 27900 27901 27905 27907 27908 27910 27911 27912 27913 27914 27915 27916 27917 27920 27921 27924 27925 27926 27963 27964 27965 27966 27967 27968 27969 27970 27971 27972 27973 27974 27975 27976 27997 27998 27999 28000 28055 28056 28057 28058 28059 28060 28061 28062 28063 28064 28065 28066 28067 28068 28069 28074 28075 28076 28077 28078 28079 28080 28081 28082 28083 28084 28085 28086 28087 28088 28089 28090 28091 ];
L = superpixels(X,241,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = lazysnapping(scaledX,L,foregroundInd,backgroundInd);

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;
end

function out = prepLab(in)

% Convert L*a*b* image to range [0,1]
out = in;
out(:,:,1) = in(:,:,1) / 100;  % L range is [0 100].
out(:,:,2) = (in(:,:,2) + 86.1827) / 184.4170;  % a* range is [-86.1827,98.2343].
out(:,:,3) = (in(:,:,3) + 107.8602) / 202.3382;  % b* range is [-107.8602,94.4780].

end
